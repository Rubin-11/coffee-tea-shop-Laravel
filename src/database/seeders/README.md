# Database Seeders - Coffee & Tea Shop

## Описание

Набор seeder'ов для заполнения базы данных интернет-магазина кофе и чая реалистичными тестовыми данными.

## Структура данных

После запуска seed'ов база данных будет содержать:

| Сущность | Количество | Описание |
|----------|-----------|----------|
| **Пользователи** | 23-27 | 2 администратора + 21-25 обычных пользователей |
| **Категории** | 13 | 5 главных + 8 подкатегорий кофе |
| **Теги** | 10 | Новинка, Хит продаж, Акция, и др. |
| **Товары** | 43-49 | 32-36 кофе + 8-10 чая + 7 аксессуаров |
| **Изображения товаров** | 86-196 | 2-4 изображения на каждый товар |
| **Отзывы** | 100-150 | Распределение: популярные (8-12), средние (3-5), новые (0-2) |
| **Статьи блога** | 11-12 | 10-11 опубликованных + 1 черновик |
| **Подписчики** | 35 | 32 активных + 3 неактивных |

## Порядок выполнения

Seeder'ы запускаются в следующем порядке (важно из-за внешних ключей):

1. **UserSeeder** - создает пользователей
2. **CategorySeeder** - создает категории и подкатегории
3. **TagSeeder** - создает теги товаров
4. **ProductSeeder** - создает товары с изображениями
5. **ReviewSeeder** - создает отзывы и обновляет рейтинги
6. **BlogPostSeeder** - создает статьи блога
7. **SubscriberSeeder** - создает подписчиков на рассылку

## Команды запуска

### Очистка БД и заполнение всеми данными

```bash
php artisan migrate:fresh --seed
```

### Заполнение без очистки (добавление данных)

```bash
php artisan db:seed
```

### Запуск конкретного seeder'а

```bash
php artisan db:seed --class=ProductSeeder
php artisan db:seed --class=ReviewSeeder
# и т.д.
```

## Тестовые аккаунты

После запуска seed'ов будут доступны следующие тестовые аккаунты:

### Администраторы

- **Email:** `admin@coffee-shop.ru`
- **Пароль:** `password`
- **Права:** Полный доступ к админ-панели

- **Email:** `maria@coffee-shop.ru`
- **Пароль:** `password`
- **Права:** Администратор, автор статей блога

### Обычные пользователи

- **Email:** `user@coffee-shop.ru`
- **Пароль:** `password`
- **Права:** Обычный пользователь

## Особенности реализации

### Товары

- **Кофе в зернах**: По 4 товара для каждой подкатегории (Колумбия, Эфиопия, Кения, и т.д.)
- **Молотый кофе**: 4 товара разного помола
- **Чай**: 8-10 разных сортов чая
- **Аксессуары**: 7 различных аксессуаров для приготовления кофе

Каждый товар имеет:
- 2-4 изображения (одно главное)
- 1-3 тега
- Характеристики: цена, вес, рейтинг, горчинка (для кофе), кислинка (для кофе)
- 30% товаров со скидкой (есть old_price)
- 25% товаров отмечены как рекомендуемые (is_featured)

### Отзывы

Распределение по товарам:
- **Популярные товары** (25%): 8-12 отзывов каждый
- **Средние товары** (50%): 3-5 отзывов каждый
- **Новые товары** (25%): 0-2 отзыва каждый

Характеристики отзывов:
- 60% - 5 звезд
- 30% - 4 звезды
- 10% - 1-3 звезды
- 70% - проверенная покупка
- 90% - одобрены модератором

После создания отзывов автоматически обновляются:
- `rating` - средний рейтинг товара
- `reviews_count` - количество одобренных отзывов

### Блог

Создается 11-12 статей:
- 3 популярные статьи о кофе (500+ просмотров)
- 2 статьи о чае
- 3 недавние статьи о кофе
- 2 обычные статьи
- 1 черновик (не опубликован)
- 2 специальные статьи с уникальным контентом:
  - "Кофе и здоровье: польза и вред кофеина" (категория: Здоровое питание)
  - "История кофе: от Эфиопии до наших дней" (категория: История происхождения)

### Изображения товаров

Используются placeholder пути:
- Кофе: `products/coffee-{number}.jpg`
- Чай: `products/tea-{number}.jpg`
- Аксессуары: `products/accessory-{number}.jpg`

> **Примечание**: Реальные файлы изображений нужно добавить в `public/storage/products/` или использовать внешние URL.

## Реалистичность данных

### Названия товаров

Используются реальные названия сортов кофе:
- Colombia Supremo, Кения АА, Эфиопия Иргачиф
- Суматра Манделинг, Бразилия Сантос, и др.

### Описания

Генерируются контекстные описания с учетом типа товара:
- Для кофе: характеристики вкуса, аромата, методы приготовления
- Для чая: вид чая, происхождение, способ заваривания
- Для аксессуаров: материал, объем, назначение

### Отзывы

Используются реалистичные шаблоны отзывов:
- Положительные: "Отличный кофе!", "Насыщенный аромат"
- Нейтральные: "Кофе неплохой, но ожидал большего"
- Отрицательные: "Разочарован", "Не понравился вкус"

## Проверка результатов

После запуска seed'ов можно проверить корректность данных:

```bash
# Количество записей в таблицах
php artisan tinker
>>> \App\Models\User::count();
>>> \App\Models\Product::count();
>>> \App\Models\Review::count();
>>> \App\Models\BlogPost::count();

# Проверка связей
>>> \App\Models\Product::with('category', 'tags', 'images')->first();
>>> \App\Models\Review::with('user', 'product')->first();

# Проверка рейтингов
>>> \App\Models\Product::where('reviews_count', '>', 0)->get(['name', 'rating', 'reviews_count']);
```

## Устранение неполадок

### Ошибка: "Class not found"

Убедитесь, что autoload обновлен:

```bash
composer dump-autoload
```

### Ошибка: "Foreign key constraint fails"

Выполните полную очистку и повторное создание БД:

```bash
php artisan migrate:fresh --seed
```

### Долгое выполнение

Создание всех seed'ов может занять 1-3 минуты в зависимости от производительности системы. Это нормально.

## Дополнительная информация

- Все seed'ы используют Factory паттерн Laravel для генерации данных
- Используется `WithoutModelEvents` для предотвращения срабатывания событий модели во время seeding
- Все пароли пользователей хешируются с помощью `bcrypt`
- Даты создаются в прошлом (от 6 месяцев назад до текущего момента) для реалистичности

## Автор

Создано для проекта Coffee & Tea Shop Laravel
